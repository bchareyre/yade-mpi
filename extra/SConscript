Import('*')

import os.path, os
brefcomMaterialModel='../brefcom-mm.hh'
if os.path.exists('../'+brefcomMaterialModel):
	print "Will include local file "+brefcomMaterialModel
	brefcomInclude=['-include',brefcomMaterialModel]
else:
	brefcomInclude=['']

env.Install('$PREFIX/lib/yade$SUFFIX/extra',[
	env.SharedLibrary('SphericalDEMSimulator',
		['spherical-dem-simulator/PersistentAloneSAPCollider.cpp',
			'spherical-dem-simulator/SphericalDEMSimulator.cpp'],
		LIBS=env['LIBS']+['yade-base',
			'MacroMicroElasticRelationships',
			'BodyMacroParameters',
			'CundallNonViscousMomentumDamping',
			'CundallNonViscousForceDamping',
			'PhysicalActionDamper',
			'InteractionPhysicsMetaEngine',
			'GravityEngine',
			'Sphere',
			'yade-multimethods',
			'yade-factory',
			'yade-serialization',
			'yade-base',
			]),

	env.SharedLibrary('Clump',
		['clump/Clump.cpp'],
		LIBS=env['LIBS']+['Shop']),

	env.SharedLibrary('ScrewGen',
		['screw/ScrewGen.cpp'],
		LIBS=env['LIBS']+['Shop','Clump']),
		
	env.SharedLibrary('Tetra',['tetra/Tetra.cpp'],LIBS=env['LIBS']+['Tetrahedron',
         'ParticleParameters',
         'RigidBodyParameters',
         'SimpleElasticInteraction',
			'ElasticBodyParameters',
			'BodyMacroParameters',
			'Momentum',
			'Force',
         'AABB']),
	
	env.SharedLibrary('TetraTestGen',['tetra/TetraTestGen.cpp'],LIBS=env['LIBS']+['Shop','Tetra']),

	env.SharedLibrary('UniaxialStrainControlledTest',['usct/UniaxialStrainControlledTest.cpp'],LIBS=env['LIBS']+['Shop','GlobalStiffnessTimeStepper','GlobalStiffnessCounter','Brefcom','PositionOrientationRecorder']),

	env.SharedLibrary('Brefcom',['Brefcom.cpp'],CXXFLAGS=env['CXXFLAGS']+brefcomInclude,LIBS=env['LIBS']+['Shop','InteractingSphere2InteractingSphere4DistantSpheresContactGeometry']),

	env.SharedLibrary('BrefcomTestGen',['BrefcomTestGen.cpp'],LIBS=env['LIBS']+['Shop','UniaxialStrainControlledTest','PositionOrientationRecorder']),

	env.SharedLibrary('Shop',
		['clump/Shop.cpp'],
		LIBS=env['LIBS']+[
			'ElasticContactLaw',
			'ElasticCohesiveLaw',
			'MacroMicroElasticRelationships',
			'ElasticCriterionTimeStepper',
			'PhysicalActionVectorVector',
			'InteractionVecSet',
			'BodyRedirectionVector',
			'InteractingSphere',
			'InteractingBox',
			'CundallNonViscousMomentumDamping',
			'CundallNonViscousForceDamping',
			'MetaInteractingGeometry',
			'GravityEngine',
			'yade-serialization',
			'yade-base',	
			'PhysicalActionContainerInitializer',
			'PhysicalActionContainerReseter',
			'InteractionGeometryMetaEngine',
			'InteractionPhysicsMetaEngine',
			'PhysicalActionApplier',
			'PhysicalParametersMetaEngine',
			'BoundingVolumeMetaEngine',
			'Box',
			'Sphere',
			'Tetra',
			'AABB',
			'PersistentSAPCollider',
			'ParticleParameters',
			'SAPCollider',
			'MetaInteractingGeometry',
			'MetaInteractingGeometry2AABB',
			# 'EMBED_PYTHON' in env['CPPDEFINES'] and 'PythonRecorder' or 'yade-base', # FIXME: handle python properly; duplicated base is harmless
			'InteractingSphere2AABB',\
			'InteractingBox2AABB',
			'NewtonsMomentumLaw',
			'NewtonsForceLaw',
			'LeapFrogPositionIntegrator',
			'LeapFrogOrientationIntegrator',
			'InteractingBox2InteractingSphere4SpheresContactGeometry',
			'Momentum',
			'Force',
			'InteractingSphere2InteractingSphere4SpheresContactGeometry',
			#'Clump',
			'yade-multimethods',
			'SpheresContactGeometry',
			'ElasticContactInteraction',
			'SDECLinkGeometry',
			'SDECLinkPhysics',
			'$QGLVIEWER_LIB'
			]),
])


